<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AR Hunter Pro</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: sans-serif; }

        /* ম্যাপ এবং বাটন */
        #map { position: fixed; top: 15px; left: 15px; width: 90px; height: 90px; border: 2px solid #0f0; border-radius: 50%; background: rgba(0,0,0,0.5); z-index: 100; }
        .enemy-dot { position: absolute; width: 8px; height: 8px; background: red; border-radius: 50%; top: 50%; left: 50%; }

        #run-btn { position: fixed; left: 30px; bottom: 120px; width: 80px; height: 80px; background: rgba(255,255,255,0.4); border: 3px solid #fff; border-radius: 50%; z-index: 100; color: white; font-weight: bold; }

        #fire-btn { position: fixed; right: 30px; bottom: 40px; width: 130px; height: 130px; background: radial-gradient(circle, #f00, #600); border: 6px solid #fff; border-radius: 50%; z-index: 100; box-shadow: 0 0 20px red; }
    </style>
</head>
<body>

    <div id="map"><div class="enemy-dot" id="dot"></div></div>
    <button id="run-btn">RUN</button>
    <button id="fire-btn"></button>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" vr-mode-ui="enabled: false">

        <a-entity id="rig" position="0 2 4">
            <a-camera look-controls></a-camera>

            <a-entity id="myPlayer" position="0 -1.5 -2.5">
                <a-cylinder color="#222" height="1.5" radius="0.3"></a-cylinder> <a-box color="#3b5998" width="0.7" height="0.8" depth="0.4" position="0 0.5 0"></a-box> <a-sphere color="#ffe0bd" radius="0.25" position="0 1.1 0"></a-sphere> <a-box color="black" width="0.1" height="0.1" depth="0.7" position="0.4 0.5 0.4"></a-box> </a-entity>
        </a-entity>

        <a-entity id="monster-box" position="0 1.5 -10">
            <a-box color="darkred" scale="3 3 3"></a-box>
        </a-entity>

    </a-scene>

    <script>
        const socket = io();
        const rig = document.getElementById('rig');
        let running = false;

        // Run Button Logic
        const runBtn = document.getElementById('run-btn');
        runBtn.addEventListener('touchstart', () => { running = true; });
        runBtn.addEventListener('touchend', () => { running = false; });

        setInterval(() => {
            if(running) {
                let pos = rig.getAttribute('position');
                pos.z -= 0.12; // সামনে দৌড়াবে
                rig.setAttribute('position', pos);
                socket.emit('move', { x: pos.x, z: pos.z });
            }

            // Map Update
            let mPos = document.getElementById('monster-box').getAttribute('position');
            let rPos = rig.getAttribute('position');
            let dx = (mPos.x - rPos.x) * 4;
            let dz = (mPos.z - rPos.z) * 4;
            document.getElementById('dot').style.transform = `translate(${dx}px, ${dz}px)`;
        }, 50);
    </script>
</body>
</html>
